<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Investment Tracker - ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
  <meta name="theme-color" content="#667eea">
  
  <!-- iOS Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Investment Tracker">
  
  <!-- SheetJS library for Excel export functionality -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      margin: 0;
      font-size: 2.5rem;
      font-weight: 700;
    }

    .header p {
      margin: 0.5rem 0 0 0;
      opacity: 0.9;
      font-size: 1.1rem;
    }

    .content {
      padding: 2rem;
    }

    .backup-section {
      background: #f1f5f9;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .backup-title {
      margin: 0 0 1.5rem 0;
      color: #1e293b;
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .backup-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .backup-card {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: all 0.3s ease;
    }

    .backup-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
    }

    .backup-card h4 {
      margin: 0 0 0.5rem 0;
      color: #374151;
      font-size: 1.1rem;
    }

    .backup-card p {
      margin: 0 0 1rem 0;
      color: #6b7280;
      font-size: 0.9rem;
    }

    .btn-export {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
      width: 100%;
    }

    .btn-export:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-input {
      position: absolute;
      left: -9999px;
      opacity: 0;
    }

    .btn-import {
      background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
      width: 100%;
      display: block;
    }

    .btn-import:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
    }

    .import-status {
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 0.9rem;
      text-align: center;
      display: none;
    }

    .import-status.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }

    .import-status.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    .backup-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
    }

    .backup-info h5 {
      margin: 0 0 0.5rem 0;
      color: #1e40af;
      font-size: 0.9rem;
    }

    .backup-info ul {
      margin: 0;
      padding-left: 1.2rem;
      color: #1e40af;
      font-size: 0.8rem;
    }

    .view-toggle {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      justify-content: center;
    }

    .toggle-btn {
      background: #f1f5f9;
      color: #64748b;
      border: 2px solid #e2e8f0;
      padding: 0.75rem 1.5rem;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .toggle-btn.active {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      border-color: #3b82f6;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .summary-card {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: 1.5rem;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }

    .summary-card h3 {
      margin: 0 0 0.5rem 0;
      color: #64748b;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .summary-card .value {
      font-size: 2rem;
      font-weight: bold;
      color: #1e293b;
    }

    .total-investment {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }

    .total-investment h3 {
      color: rgba(255, 255, 255, 0.9);
    }

    .form-container {
      background: #f8fafc;
      padding: 2rem;
      border-radius: 15px;
      margin-bottom: 2rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .form-title {
      margin: 0 0 1.5rem 0;
      color: #1e293b;
      font-size: 1.3rem;
      font-weight: 600;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr auto;
      gap: 1rem;
      align-items: end;
    }

    @media (max-width: 968px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
      }
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      margin-bottom: 0.5rem;
      color: #374151;
      font-weight: 500;
    }

    input {
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      transition: all 0.3s ease;
      background: white;
    }

    input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }

    /* Grouped View Styles */
    .grouped-container {
      display: none;
    }

    .grouped-container.active {
      display: block;
    }

    .investment-groups {
      display: grid;
      gap: 1.5rem;
    }

    .investment-group {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .investment-group:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .group-header {
      background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      color: white;
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .group-title {
      font-size: 1.3rem;
      font-weight: 600;
      margin: 0;
    }

    .group-stats {
      display: flex;
      gap: 2rem;
      font-size: 0.9rem;
    }

    .group-stat {
      text-align: center;
    }

    .group-stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      display: block;
    }

    .group-stat-label {
      opacity: 0.8;
      font-size: 0.8rem;
    }

    .expand-icon {
      transition: transform 0.3s ease;
      font-size: 1.2rem;
    }

    .investment-group.expanded .expand-icon {
      transform: rotate(180deg);
    }

    .group-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .investment-group.expanded .group-details {
      max-height: 1000px;
    }

    .transactions-table {
      width: 100%;
      border-collapse: collapse;
    }

    .transactions-table th,
    .transactions-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #f1f5f9;
    }

    .transactions-table th {
      background-color: #f8fafc;
      color: #475569;
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .transactions-table tbody tr:hover {
      background-color: #f8fafc;
    }

    .transaction-amount {
      font-weight: 600;
      color: #059669;
    }

    .cumulative-amount {
      font-weight: 700;
      color: #1e293b;
      font-size: 1.1rem;
    }

    .transaction-date {
      color: #64748b;
      font-size: 0.9rem;
    }

    .btn-delete {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-delete:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    /* Notification styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    .notification.error {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Investment Tracker</h1>
      <p>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>
    
    <div class="content">
      <!-- Backup Section -->
      <div class="backup-section">
        <h3 class="backup-title">üìä ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å/‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
        <div class="backup-controls">
          <div class="backup-card">
            <h4>Export to Excel</h4>
            <p>‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô Excel</p>
            <button class="btn-export" onclick="exportToExcel()">Download Excel</button>
          </div>
          <div class="backup-card">
            <h4>Export to JSON</h4>
            <p>‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON</p>
            <button class="btn-export" onclick="exportToJSON()">Download JSON</button>
          </div>
          <div class="backup-card">
            <h4>Import Data</h4>
            <p>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå</p>
            <div class="file-input-wrapper">
              <input type="file" id="importFile" class="file-input" accept=".json,.xlsx,.xls" onchange="importData(event)">
              <label for="importFile" class="btn-import">Choose File</label>
            </div>
            <div id="importStatus" class="import-status"></div>
          </div>
        </div>
        <div class="backup-info">
          <h5>‚ÑπÔ∏è ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</h5>
          <ul>
            <li>Excel: ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡πÅ‡∏ä‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
            <li>JSON: ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</li>
            <li>‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡πÑ‡∏ü‡∏•‡πå Excel ‡πÅ‡∏•‡∏∞ JSON</li>
          </ul>
        </div>
      </div>

      <!-- View Toggle -->
      <div class="view-toggle">
        <button class="toggle-btn active" onclick="toggleView('summary')">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
        <button class="toggle-btn" onclick="toggleView('grouped')">‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°</button>
      </div>

      <!-- Summary View -->
      <div id="summaryView" class="summary-container">
        <div class="summary-grid">
          <div class="summary-card total-investment">
            <h3>‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <div class="value" id="totalInvestment">‡∏ø0</div>
          </div>
          <div class="summary-card">
            <h3>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
            <div class="value" id="totalTransactions">0</div>
          </div>
          <div class="summary-card">
            <h3>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</h3>
            <div class="value" id="investmentTypes">0</div>
          </div>
        </div>

        <!-- Add Investment Form -->
        <div class="form-container">
          <h3 class="form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
          <form id="investmentForm" onsubmit="addInvestment(event)">
            <div class="form-grid">
              <div class="input-group">
                <label for="investmentName">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</label>
                <input type="text" id="investmentName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏´‡∏∏‡πâ‡∏ô PTT">
              </div>
              <div class="input-group">
                <label for="investmentType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                <input type="text" id="investmentType" required placeholder="‡πÄ‡∏ä‡πà‡∏ô Stock, Fund">
              </div>
              <div class="input-group">
                <label for="investmentAmount">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)</label>
                <input type="number" id="investmentAmount" required min="0" step="0.01" placeholder="0.00">
              </div>
              <button type="submit" class="btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Grouped View -->
      <div id="groupedView" class="grouped-container">
        <div class="investment-groups" id="investmentGroups">
          <!-- Groups will be dynamically generated here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Element -->
  <div id="notification" class="notification"></div>

  <script>
    // Global data storage
    let investments = [];
    let currentView = 'summary';

    // Initialize the application
    function initializeApp() {
      // Load data from localStorage if available
      const savedData = localStorage.getItem('investmentData');
      if (savedData) {
        investments = JSON.parse(savedData);
      } else {
        // Sample data for demonstration
        investments = [
          {
            id: Date.now() + 1,
            name: "‡∏´‡∏∏‡πâ‡∏ô PTT",
            type: "Stock",
            amount: 50000,
            date: new Date("2024-01-15").toISOString(),
            cumulative: 50000
          },
          {
            id: Date.now() + 2,
            name: "‡∏´‡∏∏‡πâ‡∏ô SCB",
            type: "Stock",
            amount: 30000,
            date: new Date("2024-02-20").toISOString(),
            cumulative: 80000
          },
          {
            id: Date.now() + 3,
            name: "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô SCBGOLD",
            type: "Mutual Fund",
            amount: 20000,
            date: new Date("2024-03-10").toISOString(),
            cumulative: 100000
          }
        ];
      }
      
      updateUI();
    }

    // Function to save data to localStorage
    function saveData() {
      localStorage.setItem('investmentData', JSON.stringify(investments));
    }

    // Function to show notifications
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Function to export data to Excel
    function exportToExcel() {
      try {
        // Prepare data for Excel export with proper formatting
        const worksheetData = investments.map(item => ({
          '‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô': item.name,
          '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó': item.type,
          '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)': item.amount,
          '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': new Date(item.date).toLocaleDateString('th-TH'),
          '‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏° (‡∏ö‡∏≤‡∏ó)': item.cumulative
        }));

        // Create a new workbook
        const wb = XLSX.utils.book_new();
        
        // Convert data to worksheet
        const ws = XLSX.utils.json_to_sheet(worksheetData);
        
        // Set column widths for better readability
        const colWidths = [
          { wch: 25 }, // Investment name column
          { wch: 15 }, // Type column
          { wch: 15 }, // Amount column
          { wch: 12 }, // Date column
          { wch: 15 }  // Cumulative column
        ];
        ws['!cols'] = colWidths;
        
        // Add the worksheet to the workbook
        XLSX.utils.book_append_sheet(wb, ws, "Investment Data");
        
        // Create a summary sheet
        const summaryData = [
          { '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£': '‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤': investments.reduce((sum, item) => sum + item.amount, 0) },
          { '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£': '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤': investments.length },
          { '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', '‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤': new Date().toLocaleDateString('th-TH') }
        ];
        const summaryWs = XLSX.utils.json_to_sheet(summaryData);
        summaryWs['!cols'] = [{ wch: 20 }, { wch: 20 }];
        XLSX.utils.book_append_sheet(wb, summaryWs, "Summary");
        
        // Generate filename with current date
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        const filename = `Investment_Tracker_${dateStr}.xlsx`;
        
        // Write and download the file
        XLSX.writeFile(wb, filename);
        
        showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        
      } catch (error) {
        console.error('Error exporting to Excel:', error);
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    // Function to export data to JSON
    function exportToJSON() {
      try {
        // Prepare comprehensive export data
        const exportData = {
          version: "1.0",
          exportDate: new Date().toISOString(),
          investments: investments,
          summary: {
            totalInvestment: investments.reduce((sum, item) => sum + item.amount, 0),
            totalEntries: investments.length,
            uniqueTypes: [...new Set(investments.map(item => item.type))].length
          }
        };

        // Convert to JSON string with proper formatting
        const jsonString = JSON.stringify(exportData, null, 2);
        
        // Create blob and download
        const blob = new Blob([jsonString], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        a.download = `Investment_Tracker_${dateStr}.json`;
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        
      } catch (error) {
        console.error('Error exporting to JSON:', error);
        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
      }
    }

    // Function to import data from file
    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      const fileExtension = file.name.split('.').pop().toLowerCase();

      reader.onload = function(e) {
        try {
          if (fileExtension === 'json') {
            // Handle JSON import
            const importedData = JSON.parse(e.target.result);
            
            // Validate and import data
            if (importedData.investments && Array.isArray(importedData.investments)) {
              investments = importedData.investments;
              // Ensure each investment has an ID
              investments.forEach((inv, index) => {
                if (!inv.id) inv.id = Date.now() + index;
              });
              
              saveData();
              updateUI();
              showNotification(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${investments.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
            } else {
              throw new Error('Invalid data format');
            }
            
          } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
            // Handle Excel import
            const workbook = XLSX.read(e.target.result, { type: 'binary' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const data = XLSX.utils.sheet_to_json(firstSheet);
            
            // Transform Excel data to match our format
            investments = data.map((row, index) => {
              const amount = parseFloat(row['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏ö‡∏≤‡∏ó)'] || row['Amount'] || 0);
              const dateStr = row['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'] || row['Date'] || new Date().toISOString();
              
              return {
                id: Date.now() + index,
                name: row['‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô'] || row['Investment Name'] || '',
                type: row['‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó'] || row['Type'] || '',
                amount: amount,
                date: new Date(dateStr).toISOString(),
                cumulative: parseFloat(row['‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏° (‡∏ö‡∏≤‡∏ó)'] || row['Cumulative'] || amount)
              };
            });
            
            // Recalculate cumulative amounts
            recalculateCumulative();
            
            saveData();
            updateUI();
            showNotification(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${investments.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`, 'success');
          }
          
          // Reset file input
          event.target.value = '';
          
        } catch (error) {
          console.error('Error importing data:', error);
          showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message, 'error');
        }
      };

      // Read file based on type
      if (fileExtension === 'json') {
        reader.readAsText(file);
      } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
        reader.readAsBinaryString(file);
      }
    }

    // Function to add new investment
    function addInvestment(event) {
      event.preventDefault();
      
      const name = document.getElementById('investmentName').value;
      const type = document.getElementById('investmentType').value;
      const amount = parseFloat(document.getElementById('investmentAmount').value);
      
      const newInvestment = {
        id: Date.now(),
        name: name,
        type: type,
        amount: amount,
        date: new Date().toISOString(),
        cumulative: 0 // Will be calculated
      };
      
      investments.push(newInvestment);
      recalculateCumulative();
      saveData();
      updateUI();
      
      // Reset form
      document.getElementById('investmentForm').reset();
      
      showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
    }

    // Function to delete investment
    function deleteInvestment(id) {
      if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
        investments = investments.filter(inv => inv.id !== id);
        recalculateCumulative();
        saveData();
        updateUI();
        showNotification('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      }
    }

    // Function to recalculate cumulative amounts
    function recalculateCumulative() {
      // Sort by date
      investments.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      // Recalculate cumulative
      let cumulative = 0;
      investments.forEach(inv => {
        cumulative += inv.amount;
        inv.cumulative = cumulative;
      });
    }

    // Function to toggle between views
    function toggleView(view) {
      currentView = view;
      
      // Update button states
      document.querySelectorAll('.toggle-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');
      
      // Show/hide views
      if (view === 'summary') {
        document.getElementById('summaryView').style.display = 'block';
        document.getElementById('groupedView').style.display = 'none';
      } else {
        document.getElementById('summaryView').style.display = 'none';
        document.getElementById('groupedView').style.display = 'block';
        renderGroupedView();
      }
    }

    // Function to update UI
    function updateUI() {
      // Update summary cards
      const totalInvestment = investments.reduce((sum, inv) => sum + inv.amount, 0);
      const uniqueTypes = [...new Set(investments.map(inv => inv.type))];
      
      document.getElementById('totalInvestment').textContent = `‡∏ø${totalInvestment.toLocaleString('th-TH')}`;
      document.getElementById('totalTransactions').textContent = investments.length;
      document.getElementById('investmentTypes').textContent = uniqueTypes.length;
      
      // Update grouped view if active
      if (currentView === 'grouped') {
        renderGroupedView();
      }
    }

    // Function to render grouped view
    function renderGroupedView() {
      const groupsContainer = document.getElementById('investmentGroups');
      groupsContainer.innerHTML = '';
      
      // Group investments by type
      const grouped = investments.reduce((groups, inv) => {
        const type = inv.type;
        if (!groups[type]) {
          groups[type] = [];
        }
        groups[type].push(inv);
        return groups;
      }, {});
      
      // Render each group
      Object.keys(grouped).forEach(type => {
        const groupInvestments = grouped[type];
        const groupTotal = groupInvestments.reduce((sum, inv) => sum + inv.amount, 0);
        
        const groupElement = document.createElement('div');
        groupElement.className = 'investment-group';
        groupElement.innerHTML = `
          <div class="group-header" onclick="toggleGroup(this)">
            <h3 class="group-title">${type}</h3>
            <div class="group-stats">
              <div class="group-stat">
                <span class="group-stat-value">${groupInvestments.length}</span>
                <span class="group-stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
              </div>
              <div class="group-stat">
                <span class="group-stat-value">‡∏ø${groupTotal.toLocaleString('th-TH')}</span>
                <span class="group-stat-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</span>
              </div>
            </div>
            <span class="expand-icon">‚ñº</span>
          </div>
          <div class="group-details">
            <table class="transactions-table">
              <thead>
                <tr>
                  <th>‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô</th>
                  <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                  <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                  <th>‡∏¢‡∏≠‡∏î‡∏™‡∏∞‡∏™‡∏°</th>
                  <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody>
                ${groupInvestments.map(inv => `
                  <tr>
                    <td>${inv.name}</td>
                    <td class="transaction-amount">‡∏ø${inv.amount.toLocaleString('th-TH')}</td>
                    <td class="transaction-date">${new Date(inv.date).toLocaleDateString('th-TH')}</td>
                    <td class="cumulative-amount">‡∏ø${inv.cumulative.toLocaleString('th-TH')}</td>
                    <td>
                      <button class="btn-delete" onclick="deleteInvestment(${inv.id})">‡∏•‡∏ö</button>
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
        
        groupsContainer.appendChild(groupElement);
      });
    }

    // Function to toggle group expansion
    function toggleGroup(header) {
      const group = header.parentElement;
      group.classList.toggle('expanded');
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });
  </script>
</body>
</html>